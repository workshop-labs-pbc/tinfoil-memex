shim-version: v0.3.12@sha256:b81f2295ae6750d61e94f810ce24077360001b6ec795d13643f3170df29e304d
cvm-version: 0.6.7
cpus: 16
memory: 65536

containers:
  - name: "memex"
    image: "us-central1-docker.pkg.dev/workshop-labs-pbc/pollux-docker/cpu@sha256:eb1c01fc0214d17e6a6f32d94081b745ecfdc9916d2c4190d2c6f3f9a8f260db"
    entrypoint: ["python", "-m", "src.memex.main", "--prod", "--port", "8001"]
    env:
      - KEY_MODE: "real_keys"
      - LOG_LEVEL: "INFO"
      - EMBEDDING_SERVER_URL: "https://confidential-pollux-embeddings.debug.wsl.functions.tinfoil.sh"
    secrets:
      - DATABASE_URL
      - TINFOIL_API_KEY
      - EXA_API_KEY
      - INTERNAL_SERVICE_SECRET

shim:
  listen-port: 443
  upstream-port: 8001
  publish-attestation: true
  tls-challenge: dns
  paths:
    - /ping
    - /set_dek
    - /v1/context/*
    - /v1/personalize/*
    - /v1/user/*
